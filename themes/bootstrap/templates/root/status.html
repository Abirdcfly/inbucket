{{define "title"}}Inbucket Status{{end}}

{{define "script"}}
<script src="/public/jquery.sparkline.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/public/jquery.color-2.1.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/public/metrics.js" type="text/javascript" charset="utf-8"></script>
<script>
$(document).ready(
    function() {
      $('#nav-status').addClass('active');
      loadMetrics();
      setInterval(loadMetrics, 10000);
    });
</script>
{{end}}

{{define "menu"}}
<div id="logo">
  <h1><a href="/">inbucket</a></h1>
  <h2>email testing service</h2>
</div>
{{end}}

{{define "content"}}
<h2>Inbucket Status</h2>

<p>Metrics are polled every 10 seconds.  Inbucket does not keep history for the
10 minute graphs, but your web browser will accumulate the data over time.</p>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Configuration</h3>
  </div>
  <div class="panel-body">
    <table class="metrics">
      <tr>
        <th>Version:</th>
        <td><span>{{.version}}, built on {{.buildDate}}</span></td>
      </tr>
      <tr>
        <th>SMTP Listener:</th>
        <td><span>{{.smtpListener}}</span></td>
      </tr>
      <tr>
        <th>POP3 Listener:</th>
        <td><span>{{.pop3Listener}}</span></td>
      </tr>
      <tr>
        <th>HTTP Listener:</th>
        <td><span>{{.webListener}}</span></td>
      </tr>
    </table>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">General Metrics</h3>
  </div>
  <div class="panel-body">
    <table class="metrics">
      <tr>
        <th>Uptime:</th>
        <td class="number"><span id="m-uptime">.</span></td>
      </tr>
      <tr>
        <th>System Memory:</th>
        <td class="number"><span id="m-memstatsSys">.</span></td>
        <td class="sparkline"><span id="s-memstatsSys">.</span></td>
        <td>(10min)</td>
      </tr>
      <tr>
        <th>Heap Size:</th>
        <td class="number"><span id="m-memstatsHeapSys">.</span></td>
        <td class="sparkline"><span id="s-memstatsHeapSys">.</span></td>
        <td>(10min)</td>
      </tr>
      <tr>
        <th>Heap In-Use:</th>
        <td class="number"><span id="m-memstatsHeapAlloc">.</span></td>
        <td class="sparkline"><span id="s-memstatsHeapAlloc">.</span></td>
        <td>(10min)</td>
      </tr>
      <tr>
        <th>Heap # Objects:</th>
        <td class="number"><span id="m-memstatsHeapObjects">.</span></td>
        <td class="sparkline"><span id="s-memstatsHeapObjects">.</span></td>
        <td>(10min)</td>
      </tr>
    </table>
  </div>
</div>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">SMTP Metrics</h3>
  </div>
  <div class="panel-body">
    <table class="metrics">
      <tr>
        <th>Current Connections:</th>
        <td class="number"><span id="m-smtpConnectsCurrent">.</span></td>
        <td class="sparkline"><span id="s-smtpConnectsCurrent">.</span></td>
        <td>(10min)</td>
      </tr>
      <tr>
        <th>Total Connections:</th>
        <td class="number"><span id="m-smtpConnectsTotal">.</span></td>
        <td class="sparkline"><span id="s-smtpConnectsTotal">.</span></td>
        <td>(60min)</td>
      </tr>
      <tr>
        <th>Messages Received:</th>
        <td class="number"><span id="m-smtpReceivedTotal">.</span></td>
        <td class="sparkline"><span id="s-smtpReceivedTotal">.</span></td>
        <td>(60min)</td>
      </tr>
      <tr>
        <th>Errors Logged:</th>
        <td class="number"><span id="m-smtpErrorsTotal">.</span></td>
        <td class="sparkline"><span id="s-smtpErrorsTotal"></span></td>
        <td>(60min)</td>
      </tr>
      <tr>
        <th>Warnings Logged:</th>
        <td class="number"><span id="m-smtpWarnsTotal">.</span></td>
        <td class="sparkline"><span id="s-smtpWarnsTotal"></span></td>
        <td>(60min)</td>
      </tr>
    </table>
  </div>
</div>
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Data Store Metrics</h3>
  </div>
  <div class="panel-body">
    <table class="metrics">
      <tr>
        <th>Retention Period:</th>
        <td colspan="3">
          {{if .retentionMinutes}}
          <span id="m-retentionPeriod">.</span>
          {{else}}
          Disabled
          {{end}}
        </td>
      </tr>
      <tr>
        <th>Retention Scan:</th>
        <td colspan="3">
          {{if .retentionMinutes}}
          Completed <span id="m-retentionScanCompleted">.</span> ago
          {{else}}
          Disabled
          {{end}}
        </td>
      </tr>
      <tr>
        <th>Retention Deletes:</th>
        <td class="number"><span id="m-retentionDeletesTotal">.</span></td>
        <td class="sparkline"><span id="s-retentionDeletesTotal"></span></td>
        <td>(60min)</td>
      </tr>
      <tr>
        <th>Currently Retained:</th>
        <td class="number"><span id="m-retainedCurrent">.</span></td>
        <td class="sparkline"><span id="s-retainedCurrent"></span></td>
        <td>(60min)</td>
      </tr>
    </table>
  </div>
</div>
{{end}}

