{{$name := .name}}
{{$id := .message.Id}}
<div class="btn-group btn-group-sm message-controls" role="group" aria-label="Message Controls">
  <button type="button"
          class="btn btn-default"
          onClick="window.open('/link/{{$name}}/{{$id}}');">
    <span class="glyphicon glyphicon-link" aria-hidden="true"></span>
    Link
  </button>
  <button type="button"
          class="btn btn-default"
          onClick="deleteMessage('{{.message.Id}}');">
    <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
    Delete
  </button>
  <button type="button"
          class="btn btn-default"
          onClick="messageSource('{{.message.Id}}');">
    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
    Source
  </button>
  {{if .htmlAvailable}}
    <button type="button"
            class="btn btn-default"
            onClick="htmlView('{{.message.Id}}');">
      <span class="glyphicon glyphicon-new-window" aria-hidden="true"></span>
      HTML
    </button>
  {{end}}
</div>

<div class="well well-sm message-header">
  <dl class="dl-horizontal">
    <dt>From:</dt>
    <dd>{{.message.From}}</dd>
    <dt>Date:</dt>
    <dd>{{.message.Date}}</dd>
    <dt>Subject:</dt>
    <dd>{{.message.Subject}}</dd>
  </dl>
</div>

<div id="message-body">{{.body}}</div>

{{with .attachments}}
<div class="panel panel-default message-attachments">
  <div class="panel-body">
    <ul class="list-unstyled">
      {{range $i, $e := .}}
      <li>
        {{$e.FileName}}
        ({{$e.ContentType}})
        <a href="/mailbox/vattach/{{$name}}/{{$id}}/{{$i}}/{{$e.FileName}}" target="_blank">View</a>
        <a href="/mailbox/dattach/{{$name}}/{{$id}}/{{$i}}/{{$e.FileName}}">Download</a>
      </li>
      {{end}}
    </ul>
  </div>
</div>
{{end}}
