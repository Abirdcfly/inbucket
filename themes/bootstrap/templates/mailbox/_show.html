{{$name := .name}}
{{$id := .message.ID}}
<div class="btn-group btn-group-sm message-controls" role="group" aria-label="Message Controls">
  <button type="button"
          class="btn btn-primary"
          onClick="window.open('/link/{{$name}}/{{$id}}');">
    <span class="glyphicon glyphicon-link" aria-hidden="true"></span>
    Link
  </button>
  <button type="button"
          class="btn btn-danger"
          onClick="deleteMessage('{{.message.ID}}');">
    <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
    Delete
  </button>
  <button type="button"
          class="btn btn-primary"
          onClick="messageSource('{{.message.ID}}');">
    <span class="glyphicon glyphicon-education" aria-hidden="true"></span>
    Source
  </button>
  {{if .htmlAvailable}}
    <button type="button"
            class="btn btn-primary"
            onClick="htmlView('{{.message.ID}}');">
      <span class="glyphicon glyphicon-new-window" aria-hidden="true"></span>
      HTML
    </button>
  {{end}}
</div>

<div class="panel panel-default message-header">
  <div class="panel-body">
    <dl class="dl-horizontal">
      <dt>From:</dt>
      <dd>{{.message.From}}</dd>
      <dt>Date:</dt>
      <dd>{{.message.Date}}</dd>
      <dt>Subject:</dt>
      <dd>{{.message.Subject}}</dd>
    </dl>
  </div>
</div>

<div class="message-body">{{.body}}</div>

{{with .attachments}}
<div class="well message-attachments">
  {{range $i, $e := .}}
  <div class="row">
    <div class="col-sm-6">
      <span class="glyphicon glyphicon-paperclip" aria-hidden="true"></span>
      {{$e.FileName}}
      ({{$e.ContentType}})
    </div>
    <div class="col-sm-6">
      <a class="btn btn-success btn-xs"
         role="button"
         href="/mailbox/vattach/{{$name}}/{{$id}}/{{$i}}/{{$e.FileName}}"
         target="_blank"
         aria-label="View">
        <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
        View
      </a>
      <a class="btn btn-primary btn-xs"
         role="button"
         href="/mailbox/dattach/{{$name}}/{{$id}}/{{$i}}/{{$e.FileName}}"
         aria-label="Download">
        <span class="glyphicon glyphicon-download" aria-hidden="true"></span>
        Download
      </a>
    </div>
  </div>
  {{end}}
</div>
{{end}}
